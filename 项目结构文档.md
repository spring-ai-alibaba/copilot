# Spring AI Alibaba Copilot é¡¹ç›®ç»“æ„æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**Spring AI Alibaba Copilot** æ˜¯ä¸€ä¸ªåŸºäº Spring AI Alibaba æ¡†æ¶æ„å»ºçš„æ™ºèƒ½ç¼–ç åŠ©æ‰‹ï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ã€‚é¡¹ç›®æ”¯æŒé¡¹ç›®åˆ†æã€ä»£ç ç”Ÿæˆã€æ™ºèƒ½ç¼–è¾‘å’Œé¡¹ç›®è„šæ‰‹æ¶ç­‰åŠŸèƒ½ï¼Œé€šè¿‡è‡ªç„¶è¯­è¨€äº¤äº’å¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®Œæˆç¼–ç¨‹ä»»åŠ¡ã€‚

### æŠ€æœ¯æ ˆ

**åç«¯ï¼š**
- Spring Boot 3.4.5
- Spring AI 1.0.0
- Java 17+
- Maven 3.6+
- MyBatis Plus 3.5.12
- Sa-Token 1.34.0 (æƒé™è®¤è¯)
- Redisson 3.20.1 (Rediså®¢æˆ·ç«¯)
- MySQL 8.0.32

**å‰ç«¯ï¼š**
- React 18.2.0
- TypeScript 5.5.2
- Vite 5.0.8
- Tailwind CSS 3.4.17
- Zustand 5.0.3 (çŠ¶æ€ç®¡ç†)
- Ant Design 5.23.0
- CodeMirror 6 (ä»£ç ç¼–è¾‘å™¨)
- AI SDK 4.1.46 (AIèŠå¤©åŠŸèƒ½)

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- MCP (Model Context Protocol) å·¥å…·åè®®é›†æˆ
- æµå¼èŠå¤©å“åº” (SSE)
- RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ)
- é¡¹ç›®è„šæ‰‹æ¶ç”Ÿæˆ
- ä»£ç ç¼–è¾‘å™¨é›†æˆ
- å¤šæ¨¡å‹æ”¯æŒ

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
copilot/
â”œâ”€â”€ copilot-admin/              # åç«¯ä¸»åº”ç”¨æ¨¡å—
â”œâ”€â”€ copilot-common/             # å…¬å…±æ¨¡å—
â”œâ”€â”€ copilot-modules/             # ä¸šåŠ¡æ¨¡å—
â”œâ”€â”€ ui-react/                   # å‰ç«¯Reactåº”ç”¨
â”œâ”€â”€ docs/                       # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ scripts/                    # è„šæœ¬ç›®å½•
â”œâ”€â”€ workspace/                  # å·¥ä½œç©ºé—´ç›®å½•
â””â”€â”€ pom.xml                     # Mavençˆ¶POM
```

---

## ğŸ“¦ åç«¯æ¨¡å—è¯¦è§£

### 1. copilot-admin (ä¸»åº”ç”¨æ¨¡å—)

**è·¯å¾„ï¼š** `copilot-admin/`

**èŒè´£ï¼š** Spring Boot åº”ç”¨å¯åŠ¨å…¥å£å’Œä¸»é…ç½®

**å…³é”®æ–‡ä»¶ï¼š**
- `src/main/java/com/alibaba/cloud/ai/copilot/CopilotApplication.java` - ä¸»å¯åŠ¨ç±»
- `src/main/resources/application.yml` - ä¸»é…ç½®æ–‡ä»¶
- `src/main/java/com/alibaba/cloud/ai/copilot/controller/AdminController.java` - ç®¡ç†æ§åˆ¶å™¨

**é…ç½®è¦ç‚¹ï¼š**
- æœåŠ¡ç«¯å£ï¼š6039
- æ•°æ®åº“ï¼šMySQL (é»˜è®¤ localhost:3306/spring_ai_copilot)
- å¯ç”¨å¼‚æ­¥å’Œå®šæ—¶ä»»åŠ¡

### 2. copilot-common (å…¬å…±æ¨¡å—)

**è·¯å¾„ï¼š** `copilot-common/`

åŒ…å«å¤šä¸ªå­æ¨¡å—ï¼Œæä¾›åŸºç¡€è®¾æ–½æ”¯æŒï¼š

#### 2.1 copilot-common-core
**èŒè´£ï¼š** æ ¸å¿ƒå·¥å…·ç±»å’Œé€šç”¨ç»„ä»¶
- å¸¸é‡å®šä¹‰ (`constant/`)
- é¢†åŸŸæ¨¡å‹ (`domain/`)
- æšä¸¾ç±»å‹ (`enums/`)
- å¼‚å¸¸å¤„ç† (`exception/`)
- å·¥å…·ç±» (`utils/`)

#### 2.2 copilot-common-mybatis
**èŒè´£ï¼š** MyBatis Plus é›†æˆ
- æ•°æ®æºé…ç½®
- åˆ†é¡µæ’ä»¶
- è‡ªåŠ¨å¡«å……å¤„ç†å™¨

#### 2.3 copilot-common-redis
**èŒè´£ï¼š** Redis ç¼“å­˜æ”¯æŒ
- Redisson é…ç½®
- ç¼“å­˜å·¥å…·ç±»
- é˜Ÿåˆ—å·¥å…·ç±»

#### 2.4 copilot-common-satoken
**èŒè´£ï¼š** Sa-Token æƒé™è®¤è¯
- Token é…ç½®
- æƒé™æ‹¦æˆªå™¨
- ç™»å½•ç›‘å¬å™¨

#### 2.5 copilot-common-security
**èŒè´£ï¼š** å®‰å…¨ç›¸å…³é…ç½®
- å®‰å…¨å¤„ç†å™¨
- è·¨åŸŸé…ç½®

#### 2.6 copilot-common-web
**èŒè´£ï¼š** Web é€šç”¨é…ç½®
- å…¨å±€å¼‚å¸¸å¤„ç†
- å“åº”åŒ…è£…å™¨

### 3. copilot-modules (ä¸šåŠ¡æ¨¡å—)

**è·¯å¾„ï¼š** `copilot-modules/`

#### 3.1 copilot-context (æ ¸å¿ƒä¸šåŠ¡æ¨¡å—)

**èŒè´£ï¼š** èŠå¤©ã€ä¸Šä¸‹æ–‡ç®¡ç†å’Œå·¥å…·é›†æˆ

**ä¸»è¦åŒ…ç»“æ„ï¼š**

```
copilot-context/
â”œâ”€â”€ controller/          # REST API æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ ChatController.java        # èŠå¤©APIå…¥å£
â”‚   â”œâ”€â”€ ModelController.java       # æ¨¡å‹ç®¡ç†
â”‚   â”œâ”€â”€ PromptController.java      # æç¤ºè¯ç®¡ç†
â”‚   â””â”€â”€ ...
â”œâ”€â”€ service/            # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ ChatService.java           # èŠå¤©æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ ChatHandlerImpl.java       # èŠå¤©æ¨¡å¼å¤„ç†å™¨
â”‚   â”œâ”€â”€ BuilderHandlerImpl.java    # æ„å»ºæ¨¡å¼å¤„ç†å™¨
â”‚   â”œâ”€â”€ StreamingService.java      # æµå¼å“åº”æœåŠ¡
â”‚   â”œâ”€â”€ DynamicModelService.java   # åŠ¨æ€æ¨¡å‹æœåŠ¡
â”‚   â””â”€â”€ ...
â”œâ”€â”€ tools/              # AIå·¥å…·é›†æˆ
â”‚   â”œâ”€â”€ ProjectScaffoldTool.java   # é¡¹ç›®è„šæ‰‹æ¶å·¥å…·
â”‚   â”œâ”€â”€ FileSystemTool.java        # æ–‡ä»¶ç³»ç»Ÿå·¥å…·
â”‚   â””â”€â”€ ...
â”œâ”€â”€ context/            # ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â””â”€â”€ ContextManager.java        # ä¸Šä¸‹æ–‡ç®¡ç†å™¨
â”œâ”€â”€ conversation/       # å¯¹è¯ç®¡ç†
â”‚   â””â”€â”€ ConversationService.java   # å¯¹è¯æœåŠ¡
â””â”€â”€ prompt/             # æç¤ºè¯æ¨¡æ¿
    â””â”€â”€ PromptTemplateService.java # æç¤ºè¯æ¨¡æ¿æœåŠ¡
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**

1. **èŠå¤©æœåŠ¡ (ChatService)**
   - æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š`CHAT` å’Œ `BUILDER`
   - æµå¼å“åº” (SSE)
   - å¯¹è¯å†å²ç®¡ç†
   - MCP å·¥å…·è°ƒç”¨

2. **æµå¼å“åº” (StreamingService)**
   - ä½¿ç”¨ Spring AI çš„ `Flux<ChatResponse>` å®ç°æµå¼è¾“å‡º
   - é€šè¿‡ `SseEmitter` å‘å‰ç«¯æ¨é€æ•°æ®
   - æ”¯æŒå·¥å…·è°ƒç”¨å’Œå‡½æ•°å›è°ƒ

3. **åŠ¨æ€æ¨¡å‹æœåŠ¡ (DynamicModelService)**
   - æ”¯æŒå¤šç§ LLM æ¨¡å‹ï¼ˆOpenAIã€DashScopeç­‰ï¼‰
   - åŠ¨æ€æ¨¡å‹åˆ‡æ¢
   - ç”¨æˆ·çº§æ¨¡å‹é…ç½®

4. **é¡¹ç›®è„šæ‰‹æ¶å·¥å…· (ProjectScaffoldTool)**
   - æ”¯æŒåˆ›å»º Spring Bootã€Node.jsã€React ç­‰é¡¹ç›®
   - æ¨¡æ¿åŒ–é¡¹ç›®ç”Ÿæˆ
   - å˜é‡æ›¿æ¢

#### 3.2 copilot-rag (RAGæ¨¡å—)

**èŒè´£ï¼š** æ£€ç´¢å¢å¼ºç”ŸæˆåŠŸèƒ½
- å‘é‡æ•°æ®åº“é›†æˆ (Milvus)
- æ–‡æ¡£æ£€ç´¢
- çŸ¥è¯†åº“ç®¡ç†

#### 3.3 copilot-system (ç³»ç»Ÿæ¨¡å—)

**èŒè´£ï¼š** ç³»ç»Ÿç®¡ç†åŠŸèƒ½
- ç”¨æˆ·ç®¡ç†
- ç³»ç»Ÿé…ç½®

---

## ğŸ¨ å‰ç«¯æ¨¡å—è¯¦è§£

### ui-react (Reactå‰ç«¯åº”ç”¨)

**è·¯å¾„ï¼š** `ui-react/`

**æŠ€æœ¯æ ˆï¼š**
- React 18 + TypeScript
- Vite æ„å»ºå·¥å…·
- Tailwind CSS æ ·å¼
- Zustand çŠ¶æ€ç®¡ç†
- Ant Design UIç»„ä»¶
- CodeMirror ä»£ç ç¼–è¾‘å™¨

### ç›®å½•ç»“æ„

```
ui-react/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx              # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ App.tsx               # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ api/                  # APIæ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ base.ts           # APIåŸºç¡€é…ç½®
â”‚   â”‚   â”œâ”€â”€ chat.ts           # èŠå¤©API
â”‚   â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯API
â”‚   â”‚   â”œâ”€â”€ models.ts         # æ¨¡å‹API
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ components/           # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ AiChat/           # AIèŠå¤©ç»„ä»¶ â­æ ¸å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/         # èŠå¤©ç•Œé¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx # BaseChatä¸»ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ChatInput/    # è¾“å…¥æ¡†ç»„ä»¶
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ MessageItem/  # æ¶ˆæ¯é¡¹ç»„ä»¶
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ useMessageParser.tsx  # æ¶ˆæ¯è§£æå™¨
â”‚   â”‚   â”‚   â””â”€â”€ messae.tsx            # æ¶ˆæ¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ Settings/         # è®¾ç½®ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ GeneralSettings.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MCPSettings/  # MCPå·¥å…·é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ WeIde/            # IDEç¼–è¾‘å™¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Header/           # å¤´éƒ¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ stores/               # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ chatSlice.ts      # èŠå¤©çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ userSlice.ts      # ç”¨æˆ·çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ themeSlice.ts     # ä¸»é¢˜çŠ¶æ€
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ hooks/                # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ useInit.ts        # åˆå§‹åŒ–Hook â­é‡è¦
â”‚   â”‚   â”œâ”€â”€ useRag.ts         # RAGåŠŸèƒ½Hook
â”‚   â”‚   â”œâ”€â”€ useMCPServers.ts  # MCPæœåŠ¡å™¨Hook
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ fetchInterceptor.ts # è¯·æ±‚æ‹¦æˆªå™¨
â”‚   â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯å·¥å…·
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ types/                # TypeScriptç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ chat.ts           # èŠå¤©ç›¸å…³ç±»å‹
â”‚       â””â”€â”€ mcp.ts            # MCPç›¸å…³ç±»å‹
â”œâ”€â”€ vite.config.ts            # Viteé…ç½®
â””â”€â”€ package.json              # ä¾èµ–é…ç½®
```

### æ ¸å¿ƒç»„ä»¶è¯´æ˜

#### 1. App.tsx (æ ¹ç»„ä»¶)

```1:66:ui-react/src/App.tsx
import useUserStore from "./stores/userSlice";
import useChatModeStore from "./stores/chatModeSlice";
import {GlobalLimitModal} from "./components/UserModal";
import Header from "./components/Header";
import AiChat from "./components/AiChat";
import Login from "./components/Login";
import EditorPreviewTabs from "./components/EditorPreviewTabs";
import "./utils/i18";
import classNames from "classnames";
import {ChatMode} from "./types/chat";
import {ToastContainer} from "react-toastify";
import "react-toastify/dist/ReactToastify.css";
import {UpdateTip} from "./components/UpdateTip"
import useInit from "./hooks/useInit";
import {Loading} from "./components/loading";
import TopViewContainer from "./components/TopView";

function App() {
    const {mode, initOpen} = useChatModeStore();

    const {isLoginModalOpen, closeLoginModal, openLoginModal} = useUserStore();

    const {isDarkMode} = useInit();

    return (
        <TopViewContainer>
            <GlobalLimitModal onLogin={openLoginModal}/>
            <Login isOpen={isLoginModalOpen} onClose={closeLoginModal}/>
            <div
                className={classNames(
                    "h-screen w-screen flex flex-col overflow-hidden",
                    {
                        dark: isDarkMode,
                    }
                )}
            >
                <Header/>
                <div
                    className="flex flex-row w-full h-full max-h-[calc(100%-48px)] bg-white dark:bg-[#111]"
                >
                    <AiChat/>
                    {mode === ChatMode.Builder && !initOpen && <EditorPreviewTabs/>}
                </div>
            </div>
            <UpdateTip/>
            <ToastContainer
                position="top-center"
                autoClose={2000}
                hideProgressBar={false}
                newestOnTop={false}
                closeOnClick
                rtl={false}
                pauseOnFocusLoss
                draggable
                pauseOnHover
                theme="colored"
                style={{
                    zIndex: 100000,
                }}
            />
            <Loading/>
        </TopViewContainer>
    );
}

export default App;
```

**åŠŸèƒ½ï¼š**
- åº”ç”¨å¸ƒå±€ç®¡ç†
- ç™»å½•æ¨¡æ€æ¡†æ§åˆ¶
- ä¸»é¢˜åˆ‡æ¢ï¼ˆæ·±è‰²/æµ…è‰²ï¼‰
- èŠå¤©æ¨¡å¼å’Œæ„å»ºæ¨¡å¼åˆ‡æ¢

#### 2. BaseChat (èŠå¤©ä¸»ç»„ä»¶)

**ä½ç½®ï¼š** `ui-react/src/components/AiChat/chat/index.tsx`

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- ä½¿ç”¨ `useChat` Hook (AI SDK) å¤„ç†æµå¼èŠå¤©
- è‡ªå®šä¹‰ `customFetch` å¤„ç† SSE å“åº”
- æ¶ˆæ¯å†å²ç®¡ç†ï¼ˆIndexedDBï¼‰
- MCP å·¥å…·é›†æˆ
- æ–‡ä»¶ä¸Šä¼ å’Œå›¾ç‰‡é¢„è§ˆ
- ä»£ç å—æ¸²æŸ“

**å…³é”®ä»£ç ç‰‡æ®µï¼š**

```469:497:ui-react/src/components/AiChat/chat/index.tsx
    } = useChat({
        api: apiUrl('/api/chat'),
        fetch: customFetch,
        streamProtocol: 'text',  // ä½¿ç”¨æ–‡æœ¬æµæ¨¡å¼
        headers: {
            ...(token && {Authorization: `Bearer ${token}`}),
        },
        body: {
            model: baseModal.value,
            mode: mode,
            otherConfig: {
                ...otherConfig,
                extra: {
                    ...otherConfig.extra,
                    isBackEnd: otherConfig.isBackEnd,
                    backendLanguage: otherConfig.backendLanguage
                },
            },
            // å¦‚æœæ¨¡å‹æ”¯æŒ function call ä¸”æœ‰å¯ç”¨çš„ MCP å·¥å…·ï¼Œåˆ™æ·»åŠ  tools é…ç½®
            ...(baseModal.functionCall && mcpTools.length > 0 && {
                tools: mcpTools.map(tool => ({
                    id: tool.id,
                    name: `${tool.serverName}.${tool.name}`,
                    description: tool.description || '',
                    parameters: tool.inputSchema
                }))
            })

        },
```

#### 3. useInit (åˆå§‹åŒ–Hook)

**ä½ç½®ï¼š** `ui-react/src/hooks/useInit.ts`

**åŠŸèƒ½ï¼š**
- ç”¨æˆ·è®¤è¯æ£€æŸ¥
- Token è¿‡æœŸéªŒè¯
- ä¸»é¢˜åˆå§‹åŒ–
- å›½é™…åŒ–è®¾ç½®
- ä»£ç†é…ç½®åº”ç”¨
- MCP æœåŠ¡å™¨åŒæ­¥
- å‰ªè´´æ¿ä¼˜åŒ–

#### 4. useMessageParser (æ¶ˆæ¯è§£æå™¨)

**ä½ç½®ï¼š** `ui-react/src/components/AiChat/useMessageParser.tsx`

**åŠŸèƒ½ï¼š**
- è§£ææµå¼æ¶ˆæ¯ä¸­çš„æ–‡ä»¶æ“ä½œ
- è‡ªåŠ¨åˆ›å»ºæ–‡ä»¶
- å‘½ä»¤é˜Ÿåˆ—ç®¡ç†
- ç»ˆç«¯å‘½ä»¤æ‰§è¡Œ

#### 5. çŠ¶æ€ç®¡ç† (Zustand Stores)

**ä¸»è¦Storeï¼š**

- **chatSlice.ts** - èŠå¤©çŠ¶æ€ï¼ˆæ¨¡å‹é€‰æ‹©ã€ä¸Šä¼ å›¾ç‰‡ã€é…ç½®ç­‰ï¼‰
- **userSlice.ts** - ç”¨æˆ·çŠ¶æ€ï¼ˆç™»å½•ã€ç”¨æˆ·ä¿¡æ¯ï¼‰
- **chatModeSlice.ts** - èŠå¤©æ¨¡å¼ï¼ˆCHAT/BUILDERï¼‰
- **themeSlice.ts** - ä¸»é¢˜çŠ¶æ€ï¼ˆæ·±è‰²/æµ…è‰²ï¼‰
- **useMCPSlice.ts** - MCPæœåŠ¡å™¨é…ç½®

---

## ğŸ”„ æ ¸å¿ƒæµç¨‹

### 1. èŠå¤©è¯·æ±‚æµç¨‹

```
å‰ç«¯ (BaseChat)
  â†“ useChat Hook
  â†“ POST /api/chat (SSE)
åç«¯ (ChatController)
  â†“ ChatService
  â†“ ChatHandlerImpl / BuilderHandlerImpl
  â†“ StreamingService
  â†“ ChatModel.stream()
  â†“ SseEmitter æ¨é€æµå¼æ•°æ®
å‰ç«¯æ¥æ”¶å¹¶æ¸²æŸ“
```

### 2. æ¶ˆæ¯è§£ææµç¨‹

```
AIå“åº” (æµå¼æ–‡æœ¬)
  â†“ StreamingMessageParser
  â†“ è§£ææ–‡ä»¶æ“ä½œæŒ‡ä»¤
  â†“ FileAction
  â†“ createFileWithContent()
  â†“ æ–‡ä»¶ç³»ç»Ÿæ›´æ–°
```

### 3. MCPå·¥å…·è°ƒç”¨æµç¨‹

```
ç”¨æˆ·è¾“å…¥
  â†“ å‰ç«¯å‘é€è¯·æ±‚ï¼ˆåŒ…å«toolsé…ç½®ï¼‰
  â†“ åç«¯ChatModelå¤„ç†
  â†“ æ¨¡å‹è¿”å›function_call
  â†“ åç«¯è°ƒç”¨MCPå·¥å…·
  â†“ å·¥å…·æ‰§è¡Œç»“æœè¿”å›
  â†“ ç»§ç»­å¯¹è¯
```

---

## ğŸ”Œ APIæ¥å£

### åç«¯APIç«¯ç‚¹

#### 1. èŠå¤©æ¥å£
- **POST** `/api/chat`
  - åŠŸèƒ½ï¼šå¤„ç†èŠå¤©è¯·æ±‚ï¼Œè¿”å›SSEæµå¼å“åº”
  - è¯·æ±‚ä½“ï¼š`ChatRequest` (åŒ…å«messagesã€modelã€modeç­‰)
  - å“åº”ï¼š`text/event-stream`

#### 2. æ¨¡å‹ç®¡ç†
- **GET** `/api/models` - è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨
- **GET** `/api/models/config` - è·å–æ¨¡å‹é…ç½®

#### 3. æç¤ºè¯ç®¡ç†
- **POST** `/api/prompt/enhance` - æç¤ºè¯å¢å¼º

#### 4. åº”ç”¨ä¿¡æ¯
- **GET** `/admin/info` - è·å–åº”ç”¨ä¿¡æ¯

#### 5. è®¤è¯æ¥å£
- **POST** `/auth/login` - ç”¨æˆ·ç™»å½•
- **POST** `/auth/logout` - ç”¨æˆ·ç™»å‡º

### å‰ç«¯APIå°è£…

**ä½ç½®ï¼š** `ui-react/src/api/`

- `base.ts` - APIåŸºç¡€é…ç½®å’ŒURLæ„å»º
- `chat.ts` - èŠå¤©ç›¸å…³API
- `auth.ts` - è®¤è¯API
- `models.ts` - æ¨¡å‹API
- `appInfo.ts` - åº”ç”¨ä¿¡æ¯API

---

## ğŸ› ï¸ æ ¸å¿ƒå·¥å…·å’ŒåŠŸèƒ½

### 1. MCP (Model Context Protocol) é›†æˆ

**åŠŸèƒ½ï¼š** æ”¯æŒé€šè¿‡MCPåè®®è°ƒç”¨å¤–éƒ¨å·¥å…·

**å‰ç«¯ï¼š**
- MCPæœåŠ¡å™¨é…ç½® (`components/Settings/MCPSettings/`)
- å·¥å…·åˆ—è¡¨å±•ç¤ºå’Œå¯ç”¨
- å·¥å…·è°ƒç”¨å‚æ•°é…ç½®

**åç«¯ï¼š**
- MCPå®¢æˆ·ç«¯é›†æˆ
- å·¥å…·è°ƒç”¨å¤„ç†
- å·¥å…·ç»“æœè¿”å›

### 2. é¡¹ç›®è„šæ‰‹æ¶

**å·¥å…·ç±»ï¼š** `ProjectScaffoldTool.java`

**æ”¯æŒçš„é¡¹ç›®ç±»å‹ï¼š**
- Spring Boot é¡¹ç›®
- Node.js é¡¹ç›®
- React é¡¹ç›®
- åŸºç¡€Java Mavené¡¹ç›®

### 3. ä»£ç ç¼–è¾‘å™¨

**ç»„ä»¶ï¼š** `components/WeIde/`

**åŠŸèƒ½ï¼š**
- åŸºäºCodeMirrorçš„ä»£ç ç¼–è¾‘å™¨
- æ–‡ä»¶æ ‘æµè§ˆ
- å¤šæ–‡ä»¶ç¼–è¾‘
- ä»£ç é«˜äº®
- ç»ˆç«¯é›†æˆ

### 4. RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ)

**æ¨¡å—ï¼š** `copilot-rag/`

**åŠŸèƒ½ï¼š**
- å‘é‡æ•°æ®åº“é›†æˆ (Milvus)
- æ–‡æ¡£ç´¢å¼•å’Œæ£€ç´¢
- çŸ¥è¯†åº“ç®¡ç†

---

## ğŸ“ é…ç½®æ–‡ä»¶

### åç«¯é…ç½®

**ä¸»é…ç½®ï¼š** `copilot-admin/src/main/resources/application.yml`

**å…³é”®é…ç½®é¡¹ï¼š**
- æœåŠ¡ç«¯å£ï¼š6039
- æ•°æ®åº“è¿æ¥
- Redisé…ç½®
- Spring AIæ¨¡å‹é…ç½®

### å‰ç«¯é…ç½®

**Viteé…ç½®ï¼š** `ui-react/vite.config.ts`

**å…³é”®é…ç½®ï¼š**
- å¼€å‘ä»£ç†ï¼ˆ`/api` â†’ `http://localhost:6039`ï¼‰
- è·¯å¾„åˆ«åï¼ˆ`@` â†’ `src`ï¼‰
- æ„å»ºä¼˜åŒ–

**ç¯å¢ƒå˜é‡ï¼š**
- `APP_BASE_URL` - åç«¯APIåœ°å€ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

---

## ğŸ—„ï¸ æ•°æ®å­˜å‚¨

### åç«¯æ•°æ®åº“

**æ•°æ®åº“ï¼š** MySQL

**ä¸»è¦è¡¨ï¼š**
- `sys_user` - ç”¨æˆ·è¡¨
- `model_config` - æ¨¡å‹é…ç½®è¡¨
- å¯¹è¯å†å²è¡¨ï¼ˆç”±Spring AI Memoryç®¡ç†ï¼‰

### å‰ç«¯å­˜å‚¨

**IndexedDBï¼š** ç”¨äºå­˜å‚¨èŠå¤©å†å²è®°å½•

**LocalStorageï¼š** å­˜å‚¨ç”¨æˆ·é…ç½®ã€ä¸»é¢˜ã€è¯­è¨€ç­‰

---

## ğŸš€ å¯åŠ¨å’Œè¿è¡Œ

### åç«¯å¯åŠ¨

```bash
# 1. ç¡®ä¿MySQLæ•°æ®åº“å·²åˆ›å»º
# 2. é…ç½® application.yml ä¸­çš„æ•°æ®åº“è¿æ¥
# 3. è¿è¡Œä¸»ç±»
mvn spring-boot:run
# æˆ–
java -jar copilot-admin/target/copilot-admin.jar
```

### å‰ç«¯å¯åŠ¨

```bash
cd ui-react
pnpm install
pnpm dev
```

**è®¿é—®åœ°å€ï¼š** `http://localhost:5173`

---

## ğŸ” å…³é”®ä»£ç ä½ç½®é€ŸæŸ¥

### åç«¯

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ |
|------|---------|
| èŠå¤©APIå…¥å£ | `copilot-modules/copilot-context/.../ChatController.java` |
| èŠå¤©æœåŠ¡å®ç° | `copilot-modules/copilot-context/.../ChatHandlerImpl.java` |
| æµå¼å“åº” | `copilot-modules/copilot-context/.../StreamingServiceImpl.java` |
| é¡¹ç›®è„šæ‰‹æ¶ | `copilot-modules/copilot-context/.../ProjectScaffoldTool.java` |
| æ¨¡å‹æœåŠ¡ | `copilot-modules/copilot-context/.../DynamicModelService.java` |
| ä¸»å¯åŠ¨ç±» | `copilot-admin/.../CopilotApplication.java` |

### å‰ç«¯

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ |
|------|---------|
| åº”ç”¨å…¥å£ | `ui-react/src/main.tsx` |
| æ ¹ç»„ä»¶ | `ui-react/src/App.tsx` |
| èŠå¤©ç»„ä»¶ | `ui-react/src/components/AiChat/chat/index.tsx` |
| æ¶ˆæ¯è§£æ | `ui-react/src/components/AiChat/useMessageParser.tsx` |
| åˆå§‹åŒ–Hook | `ui-react/src/hooks/useInit.ts` |
| èŠå¤©çŠ¶æ€ | `ui-react/src/stores/chatSlice.ts` |
| APIé…ç½® | `ui-react/src/api/base.ts` |

---

## ğŸ“š æ‰©å±•é˜…è¯»

- [Spring AI æ–‡æ¡£](https://spring.io/projects/spring-ai)
- [MCP åè®®æ–‡æ¡£](https://modelcontextprotocol.io/)
- [React AI SDK](https://sdk.vercel.ai/docs)
- [Zustand æ–‡æ¡£](https://zustand-demo.pmnd.rs/)

---

## ğŸ¯ å¿«é€Ÿä¸Šæ‰‹å»ºè®®

1. **ç†è§£æ¶æ„ï¼š** å…ˆç†Ÿæ‚‰å‰åç«¯åˆ†ç¦»æ¶æ„å’ŒSSEæµå¼é€šä¿¡
2. **æ ¸å¿ƒæµç¨‹ï¼š** é‡ç‚¹ç†è§£èŠå¤©è¯·æ±‚çš„å®Œæ•´æµç¨‹
3. **çŠ¶æ€ç®¡ç†ï¼š** äº†è§£Zustand Storeçš„ä½¿ç”¨æ–¹å¼
4. **APIå¯¹æ¥ï¼š** æŸ¥çœ‹`api/`ç›®å½•ä¸‹çš„æ¥å£å®šä¹‰
5. **ç»„ä»¶å¤ç”¨ï¼š** ç†Ÿæ‚‰`components/`ä¸‹çš„å¯å¤ç”¨ç»„ä»¶

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0  
**æœ€åæ›´æ–°ï¼š** 2025-11-12

